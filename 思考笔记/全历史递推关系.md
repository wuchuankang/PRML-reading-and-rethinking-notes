## 全历史递推关系



+ 在分析算法的时间复杂度的时候，对于循环递归的问题，有一种方法叫主方法。就是找到递推关系式，比如在分治算法中常见的递推式：
  $$
  T(n)=2T(n/2)+O(n)   \tag{1.1}
  $$
  但有一种递推式叫全历史递推关系（full-history recurrence relation）：
  $$
  T(n)=c+\sum_{i=1}^{n-1}T(i)  \tag{1.2}
  $$
  假定$c$和$T(1)$已知，它依赖之前所有的函数值，而不是只有前几个，对比$(1.1)$式，它只用了前面一个函数值$T(n/2)$。

  那么关于它的时间复杂度如何解决呢？

  同样只要把通项表达式求出来就可了，该通项求法很简单，但是有一个关键的陷阱，很容易着道。
  $$
  T(n)=c+\sum_{i=1}^{n-1}T(i)\\
  T(n+1)=c+\sum_{i=1}^{n}T(i)\\
  T(n+1)-T(n)=T(n)\\
  T(n+1)=2T(n)=2^nT(1)    \tag{1.3}
  $$
  上面推导的结果对不对呢？看似是对的，其实不然。出现错误的原因是忽视了base case 不满足条件。还有就是要有这样的直觉，那就是出现在递推式中的参数$c$，竟然没有出现在通项中，这显然是有问题的。这里的base case 不满足，是$T(2)=c+T(1)\neq 2T(1)$，也就是当且仅当$n>2$时，$T(n)=2T(n-1)$成立。也就是说，其实base case应该是$T(3)=2T(2)$。所以通项为：
  $$
  T(n+1)=2^{n-1}T(2)=2^{n-1}(c+T(1))   \tag{1.4}
  $$

+ 对于quicksort排序，我们来分析算法平均时间复杂度。

  由于要在序列中选择一个数作为支点（pivot）,我们任意选择一个第i个小的数做为支点，那么就会将原序列分为两个小序列，一个是小于$x_i$，一个是大于$x_i$的两个小序列的问题，其中小于$x_i$的序列的个数是$i-1$个（quicksort不需要对支点进行排序），另一个序列是$n-i$个。而分为两个小序列所要比较的次数是$n-1$次操作。那么递推关系就是：
  $$
  T(n)=n-1+T(i-1)+T(n-i), \ \ \  \ \ (n\geq2). \ \ T(1)=0    \tag{2.1}
  $$
  我们来考虑平均复杂度，因为选择任意一个数最为支点都是等可能的（我们随机选择的），因此其平均时间复杂度就是：
  $$
  \begin{aligned}
  T(n)
  &=n-1+\frac{1}{n}\sum_{i=1}^n(T(i-1)+T(n-i))\\
  &=n-1+\frac{1}{n}\sum_{i=1}^nT(i-1)+\frac{1}{n}\sum_{i=1}^nT(n-i)\\
  &=n-1+\frac{2}{n}\sum_{i=0}^{n-1}T(i), \ \ \  \ \ (n\geq2). \ \ T(1)=0
  \end{aligned}   \tag{2.2}
  $$
  要解决这个递推问题，就不是那么容易了。为了将求和符号去掉，可以采用相乘再相减的方法：
  $$
  nT(n)=(n-1)n+2\sum_{i=0}^{n-1}T(i)\\
  (n+1)T(n+1)=n(n+1)+2\sum_{i=0}^{n}T(i)\\
  (n+1)T(n+1)-nT(n)=n(n+1)-n(n-1)+2T(n)=2n+2T(n)\\
  T(n+1)=\frac{n+2}{n+1}T(n)+\frac{2n}{n+1}, \ \ \  \ \ (n\geq2). \ \ T(1)=0   \tag{2.3}
  $$
  上式$(2.3)​$是一步一步推导的。上式可以通过写成渐进式：
  $$
  T(n+1)=\frac{n+2}{n+1}T(n)+O(2)\\
  \Rightarrow  \ \ T(n)=\frac{n+1}{n}T(n-1)+O(2)\tag{2.4}
  $$
  将$(2.4)$展开可得：
  $$
  \begin{aligned}
  T(n)
  &=O(2)+\frac{n+1}{n}T(n-1)\\
  &=O(2)+\frac{n+1}{n}(O(2)+\frac{n}{n-1}T(n-2))\\
  &=O(2)+\frac{n+1}{n}O(2)+\frac{n+1}{n-1}T(n-2)\\
  &……\\
  &=O(2)+\frac{n+1}{n}O(2)+\frac{n+1}{n-1}O(2)+……+\frac{n+1}{3}T(2)\\
  &=O(2)+\frac{n+1}{n}O(2)+\frac{n+1}{n-1}O(2)+……+\frac{n+1}{3}\\
  &\leq O(2)+\frac{n+1}{n}O(2)+\frac{n+1}{n-1}O(2)+……+\frac{n+1}{3}O(2)\\
  &= O(2)(n+1)(1+\frac{1}{n}+\frac{1}{n-1}+……+\frac{1}{3})\\
  \end{aligned}   \tag{2.5}
  $$
  $H(n)=(1+1/2+1/3+...+1/n)$是调和级数(harmonic series)。调和级数是发散的，但是对于前$n$项和有一个简单的近似：
  $$
  H(n)=\ln n+\gamma+O(1/n)  \tag{2.6}
  $$
  其中$\gamma=0.577$是欧拉常数。

  从而可得平均时间复杂度：
  $$
  \begin{aligned}
  T(n)
  &=O(2)(n+1)(\ln n+\gamma+O(1/n))\\
  &=O(n\log n)
  \end{aligned}   \tag{2.7}
  $$
  要说明的是，对于quicksort，最坏情况的时候，也就是选择支点是最小数，此时的时间复杂度为$O(n^2)$，但是当序列较大时，一般取最小值的几率比较小，所以通常情况下，quicksort的时间复杂度是$O(n\log n)$。